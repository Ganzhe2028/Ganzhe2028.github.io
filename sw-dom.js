document.addEventListener("DOMContentLoaded",(()=>{const e=e=>new Promise((t=>{const o=e.endsWith("js")?"script":"link",n=4===o.length?"href":"src";for(let r of document.querySelectorAll(o)){const a=r[n];if(e.length>a?e.endsWith(a):a.endsWith(e)){const e=document.createElement(o),n=r.text||r.textContent||r.innerHTML||"";return Array.from(r.attributes).forEach((t=>e.setAttribute(t.name,t.value))),e.appendChild(document.createTextNode(n)),r.parentNode.replaceChildren(e,r),t(!0)}}t(!1)}));var t;"serviceWorker"in navigator&&navigator.serviceWorker.controller&&(sessionStorage.getItem("updated")?(sessionStorage.removeItem("updated"),caches.match("https://id.v3/").then((function(e){e?e.json().then((function(e){anzhiyuPopupManager&&anzhiyuPopupManager.enqueuePopup("通知📢",`已刷新缓存，更新为${e.global+"."+e.local}版本最新内容`,null,5e3)})):console.info("未找到匹配的缓存响应")})).catch((function(e){console.error("缓存匹配出错:",e)}))):(t="update",navigator.serviceWorker.controller.postMessage(t)),navigator.serviceWorker.addEventListener("message",(t=>{const o=t.data;switch(o.type){case"update":const t=o.update;if(!t)break;sessionStorage.setItem("updated","1"),window.Pjax?.isSupported()?Promise.all(t.map((t=>t.endsWith(".js")||t.endsWith(".css")?e(t):Promise.resolve()))).then((()=>location.reload())):location.reload();break;case"escape":sessionStorage.setItem("updated","1"),location.reload()}})))}));